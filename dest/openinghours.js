var R=(r=>(r[r.Sunday=0]="Sunday",r[r.Monday=1]="Monday",r[r.Tuesday=2]="Tuesday",r[r.Wednesday=3]="Wednesday",r[r.Thursday=4]="Thursday",r[r.Friday=5]="Friday",r[r.Saturday=6]="Saturday",r))(R||{}),F=["sun","mon","tue","wed","thu","fri","sat"];var E=(n=>(n[n.Closed=0]="Closed",n[n.Open=1]="Open",n))(E||{});function f(m,t){t||(t=Intl.DateTimeFormat().resolvedOptions().timeZone);let n=new Date(m.toLocaleString("sv",{timeZone:t}).replace(" ","T")),o=m.getTime()-n.getTime();return new Date(m.getTime()-o)}function L(m){m.getHours()===0&&m.getMinutes()===0&&(m.setHours(23),m.setMinutes(59))}function P(m){m.sort((t,n)=>t.from<n.from||t.until<n.from?-1:t.from>n.until?1:0)}function j(m){let t=m.splice(0),n;for(let o of t)!n||o.from>n.until?(m.push(o),n=o):o.until>n.until&&(n.until=o.until)}function M(m,t){for(let[n,o]of t.entries())if(o.length!==0)for(let e of o){let i=m[n],s=i.splice(0);for(let r of s)r.from>e.until||r.until<e.from?i.push(r):r.from<e.from&&r.until>e.until?i.push({from:r.from,until:e.from},{from:e.until,until:r.until}):r.from>=e.from&&r.from<=e.until&&r.until>e.until?i.push({from:e.until,until:r.until}):r.until<=e.until&&r.until>=e.from&&r.from<e.from&&i.push({from:r.from,until:e.from})}}function d(m){for(let t of m.values())P(t),j(t)}function Z(m,t,n=new Date){let{timeZone:o}=Intl.DateTimeFormat(t.locales,t.dateTimeFormatOptions).resolvedOptions(),e=f(n,o),i=e.getDay();for(let s of m[i]){let r=s.from,a=s.until;if(r<=e&&a>=e)return 1}return 0}function y(m,t,n){let[o]=m.toISOString().split("T"),e=new Date(o+"T"+n),i=t-e.getDay();return e.setDate(e.getDate()+(t<7?i:0)),e}function g(m,t){for(let n of m)t[n.from.getDay()].push({...n})}var O=class{constructor(t){this.options=t}normalize(t,n){let o={from:this.normalizeTimeString(t.from,t.day,n),until:this.normalizeTimeString(t.until,t.day,n)};L(o.until);let e=[];if(o.until<o.from){let i=y(this.options.currentDate,o.from.getDay(),"23:59:00"),s=y(this.options.currentDate,o.until.getDay()+1,"00:00:00"),r=y(this.options.currentDate,o.until.getDay()+1,o.until.toLocaleTimeString("sv"));o.until.setDate(o.until.getDate()+1),e.push({from:o.from,until:i},{from:s,until:r})}else e.push(o);return e}getTimeByCurrentDay(t){if(Array.isArray(t)){let n=this.options.currentDate,o=this.options.dateTimeFormatOptions.timeZone,[e,i,s,r]=t,a=f(n,o),p=e-a.getDay();return a.setDate(a.getDate()+p),a.setHours(i),a.setMinutes(s),a.setSeconds(r),a}else return t}normalizeTimeString(t,n,o=/\d{1,2}/g){let e=new Date(t);if(t instanceof Date||e.toString()!=="Invalid Date"&&typeof t=="string"&&t.length>=16)return this.getTimeByCurrentDay(e);if(typeof t=="string"){let i=t.match(o);if(i){let[s,r,a]=i.slice(0,3).map(l=>parseInt(l));typeof a>"u"&&(a=0),s===24&&r===0&&(s=0),s===23&&r===59&&(s=0,r=0);let p=this.getTimeByCurrentDay([n,s,r,a]);return p.getDay()!==n&&p.setDate(p.getDate()-1),p}}throw new Error(`Invalid time string: ${t}`)}};var S=["Su","Mo","Tu","We","Th","Fr","Sa"],v=class{toData(t,n){let o={...n.dateTimeFormatOptions};delete o.timeZone;let e={};for(let[s,r]of t.entries())for(let{from:a,until:p}of r){let l=a.toLocaleTimeString("sv",o)+"-"+p.toLocaleTimeString("sv",o);e[l]?e[l].includes(s)||e[l].push(s):e[l]=[s]}let i=[];for(let[s,r]of Object.entries(e)){r.sort();let a=-1,p=null,l=r.reduce((u,T)=>(a===-1||T!==a+1?(p=[T],u.push(p)):p.push(T),a=T,u),[]).map(u=>u.length>1?`${S[u[0]]}-${S[u[u.length-1]]}`:S[u[0]]).join(",");i.push(`${l} ${s}`)}return i.length>1?i:i[0]||""}fromData(t,n){let o=[[],[],[],[],[],[],[]],e=n.currentDate||new Date,i=typeof t=="string"?[t]:t,s=/[a-z]{2}-[a-z]{2}|[a-z]{2}/gi,r=/\d{2}:\d{2}:\d{2}|\d{2}:\d{2}/g,a=new O(n);for(let p of i){let l=p.match(s)||[],[u,T]=p.match(r)||["00:00","23:59"];for(let H of l){let[b,D]=H.split("-"),I=S.indexOf(b),h=S.indexOf(D);for(let c=0;c<7;c++)if(I===c&&h===-1||h>-1&&(h<I&&(c<=h||c>=I)||c>=I&&c<=h)){let $=a.normalize({day:c,from:y(e,c,u),until:y(e,c,T)});g($,o)}}}return d(o),o}};var w=class{toData(t,n){let o=[],e={...n.dateTimeFormatOptions};delete e.timeZone;for(let i=0;i<t.length;i++)if(t[i].length!==0)for(let{from:s,until:r,text:a}of t[i])o.push({day:i,from:s.toLocaleTimeString("sv",e).replace(/:/g,""),until:r.toLocaleTimeString("sv",e).replace(/:/g,""),text:a});return o}fromData(t,n){let o=[[],[],[],[],[],[],[]],e=new O(n);for(let i of t){let s=e.normalize(i);g(s,o)}return d(o),o}};var x=class{toData(t,n){let o={...n.dateTimeFormatOptions},e=n.dateTimeFormatOptions.timeZone;delete o.timeZone;let{currentDate:i,locales:s}=n,r=n.text?.weekDays||F,a=[];for(let[l,u]of t.entries()){let T=f(i,e).getDay()===l;u.length===0?a[l]=n.showClosedDays?{active:T,day:r[l],times:[]}:null:a[l]={active:T,day:r[l],times:u.map(H=>{let b=H.from,D=H.until;D.getHours()===0&&D.getMinutes()===0&&(D.setHours(23),D.setMinutes(59),D.setSeconds(0),D.setMilliseconds(0));let I=b.toLocaleTimeString(s,o),h=D.toLocaleTimeString(s,o);return{from:I,until:h}})}}this.setLeadingDay(a,n);let p=[];for(let l of a)l&&p.push(l);return p}setLeadingDay(t,n){let{currentDate:o,currentDayOnTop:e,weekStart:i}=n,s=n.dateTimeFormatOptions?.timeZone,r=o&&e?f(o,s).getDay():i!==void 0?i:0;if(r>0){let a=t.splice(r);t.unshift(...a)}}};var z=class{toData(t,n){let{timespanSeparator:o,closed:e}=n.text||{},i=[],r=new x().toData(t,n);for(let a of r){let p;a.times.length?p=`${a.day} ${a.times.map(l=>l.from+o+l.until).join(", ")}`:p=`${a.day} ${e}`,i.push(a.active?"["+p+"]":p)}return i.join(`
`)}};var C=class m{static defaultOptions={weekStart:1,currentDate:new Date,currentDayOnTop:!1,locales:"de-DE",dateTimeFormatOptions:{timeZone:"Europe/Berlin",hour:"2-digit",minute:"2-digit"},text:{closed:"closed",open:"open",timespanSeparator:" - ",weekDays:F},showClosedDays:!1};options;currentDate;get times(){let t=this.currentDate,n=t.getDay(),o=this.internalTimes.default.slice(0),e=[[],[],[],[],[],[],[]];for(let i of this.internalTimes.seasons.values())for(let s=0;s<7;s++)n>s?t.setDate(t.getDate()-(n-s)):t.setDate(t.getDate()+s),t>=i.fromDate&&t<=i.untilDate&&(o[s]=(i.times||e)[s].slice(0));return o}internalTimes;constructor(t={}){this.options={...m.defaultOptions,...t,dateTimeFormatOptions:{...m.defaultOptions.dateTimeFormatOptions,...t.dateTimeFormatOptions||{}},text:{...m.defaultOptions.text,...t.text||{}}},this.currentDate=this.options.currentDate,this.internalTimes={default:[[],[],[],[],[],[],[]],seasons:new Set}}getState(t=new Date){return Z(this.internalTimes.default,this.options,t)}isOpenSoon(t=new Date,n){let{timeZone:o}=Intl.DateTimeFormat(this.options.locales,this.options.dateTimeFormatOptions).resolvedOptions(),e=f(t,o),i=e.getDay(),s=new Date(e);s.setSeconds(s.getSeconds()+(n||1800));for(let r of this.times[i]){let a=r.from;if(a>=e&&a<=s)return!0}return!1}isClosedSoon(t=new Date,n){let{timeZone:o}=Intl.DateTimeFormat(this.options.locales,this.options.dateTimeFormatOptions).resolvedOptions(),e=f(t,o),i=e.getDay(),s=new Date(e);s.setSeconds(s.getSeconds()+(n||1800));for(let r of this.times[i]){let a=r.from,p=r.until;if(a<=e&&p>=e&&s>p)return!0}return!1}getNextOpenTime(t=new Date){let{timeZone:n}=Intl.DateTimeFormat(this.options.locales,this.options.dateTimeFormatOptions).resolvedOptions(),{locales:o}=this.options,e={...this.options.dateTimeFormatOptions};delete e.timeZone;let i=f(t,n),s=i.getDay();for(let r of this.times[s]){let a=r.from,p=r.until;if(a<=i&&p>=i)return this.options.text.open;if(a>i&&p>i)return a.toLocaleTimeString(o,e)}return this.options.text.closed}add(t,n,o){let e=new O(this.options),i={day:t,from:n,until:o},s=e.normalize(i);g(s,this.internalTimes.default),d(this.internalTimes.default)}cut(t,n,o){typeof t=="number"&&(t=[t]);let e=new O(this.options),i=[[],[],[],[],[],[],[]];for(let s of t){let r={day:s,from:n,until:o},a=e.normalize(r);g(a,i)}M(this.internalTimes.default,i),d(this.internalTimes.default)}cutMulti(t){let n=new O(this.options),o=[[],[],[],[],[],[],[]];for(let e of t){let i=[],s=[];if(typeof e.days<"u"?i.push(...e.days):typeof e.day=="number"&&i.push(e.day),typeof e.spans<"u")for(let r of e.spans)for(let a of i)s.push({day:a,from:r.from||"0000",until:r.until||"2359"});else for(let r of i)s.push({day:r,from:e.from||"0000",until:e.until||"2359"});for(let r of s){let a=n.normalize(r);g(a,o)}}M(this.internalTimes.default,o),d(this.internalTimes.default)}fromJSON(t,n={}){let o=new w;this.internalTimes.default.splice(0);let e=o.fromData(t,{...this.options,...n});this.internalTimes.default.push(...e)}toJSON(t){return new w().toData(this.times,{...this.options,...t||{}})}fromMicrodata(t,n={}){let o=new v;this.internalTimes.default.splice(0);let e=o.fromData(t,{...this.options,...n});this.internalTimes.default.push(...e)}toMicrodata(t){return new v().toData(this.times,{...this.options,...t||{}})}toLocaleJSON(t){return new x().toData(this.times,{...this.options,...t||{}})}toString(t){return new z().toData(this.times,{...this.options,...t||{}})}};export{x as DisplayJson,z as DisplayText,w as Json,v as Microdata,E as OpenState,C as OpeningHours,R as WeekDays,F as WeekDaysShort};
//# sourceMappingURL=openinghours.js.map
